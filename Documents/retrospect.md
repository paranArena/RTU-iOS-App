# 1.04 업데이트 

## 요구사항이 무엇인가? 

기존에는 물품을 등록할 때 반드시 위치를 설정해야했다. 사용자들로부터 위치에 상관없이 물품을 대여할 수 있게해달라고 요구를 받았고 1.04에는 이 기능만 수정하기로 하였다. 

## 오래 걸린 이유 

이틀이면 끝날거라고 자신했다. 학생 신분이라 시간을 온전히 프로젝트에 쓰지는 못했지만 그것을 감안하여 이틀이었다. 예상보다 시간이 오래걸렸고 테스트 코드를 작성하기 전에 잠깐 그 이유를 살펴보려고 한다. 

첫번째로 협업 기간을 고려하지 못했다. 디자이너가 피그마에서 작업을 끝낸 후 변경을 시작할 수 있는데 내 시간만 고려했다. 이번에는 백엔드에서 수정할 필요가 없었기때문에 딜레이되는 시간이 짧았지만 백엔드와 디자이너가 작업하는 시간을 모두 고려해야한다. 

두번째로 내 업무 조차도 기간을 예측하는 것이 그냥 짐작이었다. 요구 사항을 듣고 막연하게 그러면 기존에 있던 것을 옵셔널로 변경해주고 이것만 처리하면 되겠다고 생각했다. 물론 전반적으로 옵셔널 처리만 하면 됐던 것은 맞지만 몇몇 더 변경될 것들이 존재했다. 기존에는 예약(request) 후 대여 확정(apply) 순으로 api를 보내야했지만 물품의 장소가 정해지지 않은 경우 예약을 할 필요가 없었고 바로 apply를 해야한다. 아마 사전에 더 고려를 해보았어도 이런것까지는 실제 개발을 하고 알았을 것 같지만 너무 일정을 빠듯하게 가져가려고 했다. 위치 기반 서비스를 사용하는지 아닌지에 따라서 뷰의 hidden 유무가 바뀔 필요도 있었다. 

세번째는 이전의 코드가 너무 나빴다. 앱 배포를 하루이틀 앞두고서 alert나 여러 기능들이 추가되었고 팀원을 모두가 밤을 새우며 개발했었다. 이번에 수정한 부분이 이 기간에 만든 기능이었는데 재사용도 어렵고 코드도 난잡했다. 처음에는 MVVM만 사용하다가 나중에 api 통신을 위한 Service클래스를 추가했었는데 이 때 당시에는 Service 클래스도 사용하지 않았었다. 불가피하게 리팩토링을 하느라 시간이 더 소요됐다. 

## 무엇을 배웠는가

소프트웨어공학 강의에서, 예전에는 코드의 재사용성에만 집중했다면 최근에는 당연히 유연성과 확장성까지도 고려해야 한다고 들었다. 1.03 업데이트까지는 자잘한 버그의 수정이나 새로운 기능 추가만 했었기때문에 이것의 중요성을 느낄 수 없었는데 이번에 기존의 기능을 수정하는 작업을 하면서 중요성을 조금 느꼈다. 

기능을 변경하면서 기존에는 잘 동작했던 것들에 버그가 생길 수가 있고 최악의 경우에는 버그인줄도 모르는 경우도 있었다. 그리고 이것을 방지하기 위한 테스트코드의 필요성도 느꼈다.

백엔드의 DB테이블과 DTO를 알고 있는 편이 좋다. 이번에 변경해야할건 latitude, longitude를 옵셔널로 바꾸는거였다. 그리고 백엔드에서는 데이터를 아래 json 포맷으로 보내준다. 
```json 
location: { 
	name: "" 
	latitude: null 
	longitude: null 
}
``` 
이 location 타입은 물건의 정보를 가져올 때와 대여(예약)정보를 가져올 때 모두 공통적으로 사용된다. 백엔드에서는 그랬지만 나는 각 struct마다 inner class로 선언되어 있었다. Product, Rent 정보를 담는 struct에 location 구현되어 있으니 우선 product만 수정했다가 나중에 rent에서 정보를 가져오지 못하는 문제가 발생해서 두번 수정했다. 

처음부터 백엔드에서 location을 재사용하고 있었다는걸 알았다면 이런 문제는 없었을 것이다. 최소한 그냥 하나의 { } 감싸진 것을 다 개별적으로 구현하고 있어도 됐다. 내가 봤던 많은 alamofire 예제들이 inner class를 사용하고 있어서 나도 무의식적으로 사용한거 같은데 앞으로 Codable을 준수하는 구조체에 inner class 사용은 지양해야한다. 





